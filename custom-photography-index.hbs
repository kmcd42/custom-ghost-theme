{{!< default}}
{{!--
Template Name: Photography Index
Description: Immersive full-gallery photography experience with tag filtering
--}}

{{#post}}
<div class="photo-gallery-page">

    {{!-- Minimal Header --}}
    <header class="photo-gallery-header reveal-on-scroll">
        <h1 class="photo-gallery-title kinetic-text">{{title}}</h1>
        {{#if custom_excerpt}}
            <p class="photo-gallery-intro">{{custom_excerpt}}</p>
        {{/if}}
    </header>

    {{!-- Tag Filter Pills --}}
    {{#get "tags" filter="visibility:public" limit="all"}}
        {{#if tags}}
            <nav class="photo-gallery-filters reveal-on-scroll" aria-label="Filter by tag">
                <button class="photo-filter-pill active" data-filter="all">
                    <span>All</span>
                </button>
                {{#foreach tags}}
                    {{!-- Only show tags that have photography posts --}}
                    {{#get "posts" filter="tag:photography+tag:{{slug}}" limit="1"}}
                        {{#if posts}}
                            <button class="photo-filter-pill" data-filter="{{slug}}">
                                <span>{{name}}</span>
                            </button>
                        {{/if}}
                    {{/get}}
                {{/foreach}}
            </nav>
        {{/if}}
    {{/get}}

    {{!-- Masonry Photo Grid --}}
    <div class="photo-gallery-grid">
        {{#get "posts" limit="100" filter="tag:photography" include="tags"}}
            {{#foreach posts}}
                <article class="photo-gallery-item reveal-on-scroll"
                         data-tags="{{#foreach tags}}{{slug}} {{/foreach}}"
                         style="--stagger: {{@index}}">
                    <a href="{{url}}" class="photo-gallery-link">
                        {{#if feature_image}}
                            <figure class="photo-gallery-figure">
                                <img
                                    srcset="{{img_url feature_image size="s"}} 400w,
                                            {{img_url feature_image size="m"}} 720w,
                                            {{img_url feature_image size="l"}} 1200w"
                                    sizes="(max-width: 600px) 100vw, (max-width: 1200px) 50vw, 33vw"
                                    src="{{img_url feature_image size="m"}}"
                                    alt="{{#if feature_image_alt}}{{feature_image_alt}}{{else}}{{title}}{{/if}}"
                                    loading="lazy"
                                />
                                <figcaption class="photo-gallery-caption">
                                    <span class="photo-gallery-name">{{title}}</span>
                                    {{#if primary_tag}}
                                        <span class="photo-gallery-tag">{{primary_tag.name}}</span>
                                    {{/if}}
                                </figcaption>
                            </figure>
                        {{/if}}
                    </a>
                </article>
            {{/foreach}}
        {{/get}}
    </div>

    {{!-- Empty state --}}
    {{#get "posts" filter="tag:photography" limit="1"}}
        {{#unless posts}}
            <div class="photo-gallery-empty">
                <p>No photography posts yet. Tag posts with "photography" to display them here.</p>
            </div>
        {{/unless}}
    {{/get}}

    {{!-- Optional content --}}
    {{#if content}}
        <div class="photo-gallery-content gh-content reveal-on-scroll">
            {{content}}
        </div>
    {{/if}}

</div>

{{!-- Tag Filtering Script --}}
<script>
(function() {
    const filters = document.querySelectorAll('.photo-filter-pill');
    const items = document.querySelectorAll('.photo-gallery-item');

    if (!filters.length || !items.length) return;

    filters.forEach(filter => {
        filter.addEventListener('click', () => {
            const tag = filter.dataset.filter;

            // Update active state
            filters.forEach(f => f.classList.remove('active'));
            filter.classList.add('active');

            // Filter items
            items.forEach(item => {
                const tags = item.dataset.tags || '';
                if (tag === 'all' || tags.includes(tag)) {
                    item.style.display = '';
                    item.classList.remove('hidden');
                } else {
                    item.style.display = 'none';
                    item.classList.add('hidden');
                }
            });
        });
    });
})();
</script>
{{/post}}
